<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Librería Belén - Detalle de producto</title>
    <meta
      name="description"
      content="Detalle de producto con información, variantes y compras por WhatsApp."
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Fraunces:wght@500;700&family=Manrope:wght@400;600;700&display=swap"
    />
    <link rel="stylesheet" href="assets/css/styles.css" />
    <script type="application/ld+json" id="product-jsonld"></script>
    <link rel="manifest" href="manifest.webmanifest" />
    <meta name="theme-color" content="#0D615A" />
    <link rel="apple-touch-icon" href="assets/img/icon.svg" />
  </head>
  <body>
<header class="hero hero-small">
      <div class="topbar">
        <div class="brand">
          <img src="assets/img/logonuevo.webp" alt="Librería Belén" />
        </div>
        <button class="menu-toggle" type="button" aria-label="Abrir menú" aria-expanded="false" aria-controls="primary-menu">Menú</button>
        <nav class="menu" id="primary-menu" aria-label="Menú principal">
          <a href="index.html">Inicio</a>
          <a href="catalogo.html">Catálogo</a>
          <a href="ofertas.html">Ofertas</a>
          <a href="contacto.html">Contacto</a>
          <details class="menu-dropdown">
            <summary>Trabajos</summary>
            <div class="dropdown">
              <a href="redaccion.html">Redacción de documentos</a>
              <a href="trabajos.html">Trabajos e investigaciones</a>
              <a href="otros-trabajos.html">Otros trabajos</a>
            </div>
          </details>
        </nav>
        <button class="cart" data-cart-toggle>
          Carrito (<span data-cart-count>0</span>)
        </button>
      </div>
      <div class="hero-content" data-parallax="0.06">
        <h1>Detalle del producto</h1>
        <p>Conoce cada detalle antes de agregarlo al carrito.</p>
      </div>
    </header>

<main class="detail">
      <section class="detail-card">
        <div class="detail-gallery">
          <div class="image-frame image-frame-detail">
            <img id="detail-image" class="product-image" alt="" loading="lazy" decoding="async" />
            <img class="image-logo" src="assets/img/logonuevo.png" alt="Librería Belén" loading="lazy" decoding="async" />
            <span class="image-disclaimer">
              Imagen referencial - Librería Belén no es dueña de la propiedad y/o autoría de la imagen.
            </span>
          </div>
          <div class="detail-thumbs" id="detail-thumbs"></div>
        </div>
        <div class="detail-info">
          <div class="detail-header">
            <p class="detail-tag" id="detail-tag">Producto destacado</p>
            <span class="detail-stock" id="detail-stock">En stock</span>
          </div>
          <h2 id="detail-title">Producto</h2>
          <div class="detail-rating" id="detail-rating">Rating 0.0</div>
          <p id="detail-description">
            Descripción completa del producto.
          </p>
          <p id="detail-synopsis" class="detail-synopsis" hidden></p>
          <dl class="detail-specs" id="detail-specs"></dl>
          <ul id="detail-list" class="detail-list"></ul>
          <div class="detail-variants">
            <label>
              Color
              <select id="detail-color"></select>
            </label>
            <label>
              Tamano
              <select id="detail-size"></select>
            </label>
          </div>
          <div class="detail-actions">
            <span id="detail-price" class="price">S/ 0.00</span>
            <button data-add-to-cart type="button">Agregar al carrito</button>
            <a
              class="btn-ghost"
              id="detail-whatsapp"
              href="#"
              target="_blank"
              rel="noopener"
            >
              Consultar por WhatsApp
            </a>
          </div>
        </div>
      </section>
      <section class="detail-reviews">
        <h3>Descripción y uso</h3>
        <p class="detail-usage-text" id="detail-usage-text"></p>
        <div id="detail-usage-list"></div>
      </section>
    </main>
    <footer class="site-footer">
      <div>
        <h4>Librería Belén</h4>
        <p>Especialistas en lectura, estudio y regalos.</p>
        <p>Horario: Lun - Sab, 9:00 a 19:00</p>
      </div>
      <div>
        <h4>Métodos de pago</h4>
        <p>Tarjetas, transferencia y efectivo.</p>
      </div>
      <div>
        <h4>Redes</h4>
        <a href="index.html">Instagram</a>
        <a href="index.html">Facebook</a>
        <a href="index.html">TikTok</a>
      </div>
    </footer>
    <aside class="cart-panel" id="cart-panel" aria-hidden="true">
      <div class="cart-panel-content">
        <div class="cart-panel-header">
          <h3>Tu carrito</h3>
          <button class="cart-close" type="button">Cerrar</button>
        </div>
        <div class="cart-items" id="cart-items"></div>
        <div class="cart-footer">
          <div class="cart-total">
            Total <span id="cart-total">S/ 0.00</span>
          </div>
          <button class="cart-checkout" type="button" data-checkout>
            Finalizar compra
          </button>
        </div>
        <form class="checkout" id="checkout-form" hidden>
          <h4>Datos para envío</h4>
          <label>
            Nombre completo
            <input type="text" id="customer-name" required />
          </label>
          <label>
            Dirección
            <input type="text" id="customer-address" required />
          </label>
          <label>
            Teléfono
            <input type="tel" id="customer-phone" required />
          </label>
          <label>
            Nota adicional
            <textarea id="customer-note" rows="3"></textarea>
          </label>
          <button class="checkout-send" type="button" data-send-whatsapp>
            Enviar pedido por WhatsApp
          </button>
        </form>
        <div class="payment-section" id="payment-section" hidden>
          <h4>Resumen y pago</h4>
          <div class="order-summary" id="order-summary"></div>
          <button class="btn-ghost" type="button" id="download-pdf">
            Descargar PDF
          </button>
          <div class="qr-grid">
            <div class="qr-card">
              <span>Yape</span>
              <div class="qr-placeholder">Sube QR de Yape</div>
            </div>
            <div class="qr-card">
              <span>Plin</span>
              <div class="qr-placeholder">Sube QR de Plin</div>
            </div>
          </div>
          <p class="payment-note">
            Luego de pagar, adjunta el comprobante por WhatsApp.
          </p>
        </div>
      </div>
    </aside>
    <a
      class="whatsapp-float"
      href="https://wa.me/51947872207?text=Hola%2C%20quiero%20informaci%C3%B3n%20sobre%20un%20producto."
      target="_blank"
      rel="noopener"
      aria-label="Contactar por WhatsApp"
    >
      WhatsApp
    </a>

    <script defer src="assets/js/products.js"></script>
    <script defer src="assets/js/product-specs.js"></script>
    <script>
      window.addEventListener("DOMContentLoaded", () => {
      const products = window.PRODUCTS || {};
      const params = new URLSearchParams(window.location.search);
      const requestedId = params.get("id");
      const productKeys = Object.keys(products);
      const fallbackId = productKeys[0];
      const productId =
        requestedId && products[requestedId] ? requestedId : fallbackId;
      const product = productId ? products[productId] : null;
      if (!product) {
        const main = document.querySelector("main");
        if (main) {
          main.innerHTML = `<p class="no-results">Producto no encontrado. <a href="catalogo.html">Volver al catálogo</a>.</p>`;
        }
        console.warn("Producto no encontrado para id", requestedId);
        return;
      }
      const specs =
        (window.PRODUCT_SPECS && window.PRODUCT_SPECS[productId]) || {};
      const merged = { ...product, ...specs };
      if (specs.gallery && specs.gallery.length) {
        merged.gallery = specs.gallery;
      }

      const image = document.getElementById("detail-image");
      const title = document.getElementById("detail-title");
      const description = document.getElementById("detail-description");
      const synopsis = document.getElementById("detail-synopsis");
      const price = document.getElementById("detail-price");
      const list = document.getElementById("detail-list");
      const thumbs = document.getElementById("detail-thumbs");
      const rating = document.getElementById("detail-rating");
      const stock = document.getElementById("detail-stock");
      const tag = document.getElementById("detail-tag");
      const colorSelect = document.getElementById("detail-color");
      const sizeSelect = document.getElementById("detail-size");
      const usageText = document.getElementById("detail-usage-text");
      const usageList = document.getElementById("detail-usage-list");

      image.src = merged.image;
      image.alt = merged.title;
      title.textContent = merged.title;
      description.textContent = merged.description;
      if (synopsis) {
        synopsis.textContent = merged.synopsis || "";
        synopsis.hidden = !merged.synopsis;
      }
      const displayPrice = "Muy pronto";
      price.textContent = displayPrice;
      rating.textContent = `Rating ${merged.rating}`;
      stock.textContent = merged.stock <= 3 ? "Stock bajo" : "En stock";
      stock.className = merged.stock <= 3 ? "detail-stock low" : "detail-stock";
      tag.textContent = merged.tag === "oferta" ? "Oferta" : "Nuevo";
      tag.className = merged.tag === "oferta" ? "detail-tag sale" : "detail-tag";
      document.title = `${merged.title} - Librería Belén`;
      const metaDescription = document.querySelector('meta[name="description"]');
      if (metaDescription) {
        metaDescription.content = `${merged.title}. ${merged.description}`;
      }
      list.innerHTML = "";
      if (Array.isArray(merged.details)) {
        merged.details.forEach((item) => {
          const li = document.createElement("li");
          li.textContent = item;
          list.appendChild(li);
        });
      }

      if (thumbs) {
        thumbs.innerHTML = "";
        (merged.gallery || [merged.image]).forEach((src, index) => {
          const button = document.createElement("button");
          button.type = "button";
          button.className = index === 0 ? "thumb active" : "thumb";
          button.style.backgroundImage = `url("${src}")`;
          button.addEventListener("click", () => {
            image.src = src;
            thumbs.querySelectorAll(".thumb").forEach((t) =>
              t.classList.remove("active")
            );
            button.classList.add("active");
          });
          thumbs.appendChild(button);
        });
      }

      const fillSelect = (select, values) => {
        if (!select) return;
        select.innerHTML = "";
        values.forEach((value) => {
          const option = document.createElement("option");
          option.value = value;
          option.textContent = value;
          select.appendChild(option);
        });
      };

      fillSelect(colorSelect, merged.colors || []);
      fillSelect(sizeSelect, merged.sizes || []);

      const addButton = document.querySelector("[data-add-to-cart]");
      const whatsappButton = document.getElementById("detail-whatsapp");
      const WHATSAPP_NUMBER = "51947872207";
      const buildWhatsappMessage = () => {
        const color = colorSelect ? colorSelect.value : "";
        const size = sizeSelect ? sizeSelect.value : "";
        const variantParts = [];
        if (color) variantParts.push(`Color: ${color}`);
        if (size) variantParts.push(`Tamano: ${size}`);
        const lines = [
          `Hola, quiero información sobre: ${merged.title}`,
          `Precio: ${displayPrice}`,
          variantParts.length ? `Variante: ${variantParts.join(" | ")}` : "",
          `Link: ${window.location.href}`,
        ].filter(Boolean);
        return encodeURIComponent(lines.join("\n"));
      };
      const updateWhatsappLink = () => {
        if (!whatsappButton) return;
        whatsappButton.href = `https://wa.me/${WHATSAPP_NUMBER}?text=${buildWhatsappMessage()}`;
      };
      const updateVariant = () => {
        const color = colorSelect ? colorSelect.value : "";
        const size = sizeSelect ? sizeSelect.value : "";
        const parts = [];
        if (color) parts.push(`Color: ${color}`);
        if (size) parts.push(`Tamano: ${size}`);
        if (addButton) {
          addButton.dataset.variant = parts.join(" | ");
        }
        updateWhatsappLink();
      };

      if (colorSelect) {
        colorSelect.addEventListener("change", updateVariant);
      }
      if (sizeSelect) {
        sizeSelect.addEventListener("change", updateVariant);
      }
      updateVariant();

      if (usageText) {
        usageText.textContent = merged.longDescription || merged.description || "";
      }
      if (usageList) {
        usageList.innerHTML = "";
        if (Array.isArray(merged.usage)) {
          merged.usage.forEach((item) => {
            const card = document.createElement("div");
            card.className = "review-card";
            card.innerHTML = `<p>${item}</p>`;
            usageList.appendChild(card);
          });
        }
      }

      if (addButton) {
        addButton.dataset.id = productId || "producto";
        addButton.dataset.title = merged.title;
        addButton.dataset.price = "0";
        addButton.disabled = true;
        addButton.textContent = "Muy pronto";
      }

      const specsContainer = document.getElementById("detail-specs");
      if (specsContainer) {
        const specEntries = [
          ["Sinopsis", merged.synopsis],
          ["ISBN", merged.isbn],
          ["Paginas", merged.pages ? String(merged.pages) : ""],
          ["Tamano", merged.size],
          ["Editorial", merged.publisher],
          ["Fecha", merged.publishedAt],
        ].filter(([, value]) => value);
        specsContainer.innerHTML = "";
        specEntries.forEach(([label, value]) => {
          const dt = document.createElement("dt");
          dt.textContent = label;
          const dd = document.createElement("dd");
          dd.textContent = value;
          specsContainer.append(dt, dd);
        });
      }

      const jsonLd = document.getElementById("product-jsonld");
      if (jsonLd) {
        const imageList = [merged.image].concat(merged.gallery || []).filter(Boolean);
        const priceValue = Number(String(merged.price || "").replace(/[^0-9.]/g, ""));
        const additionalProperty = [
          merged.isbn
            ? { "@type": "PropertyValue", "name": "ISBN", "value": merged.isbn }
            : null,
          merged.pages
            ? { "@type": "PropertyValue", "name": "Paginas", "value": merged.pages }
            : null,
          merged.size
            ? { "@type": "PropertyValue", "name": "Tamano", "value": merged.size }
            : null,
          merged.publisher
            ? { "@type": "PropertyValue", "name": "Editorial", "value": merged.publisher }
            : null,
          merged.publishedAt
            ? { "@type": "PropertyValue", "name": "Fecha", "value": merged.publishedAt }
            : null,
        ].filter(Boolean);
        const productJson = {
          "@context": "https://schema.org",
          "@type": "Product",
          "name": merged.title,
          "description": merged.description,
          "image": imageList,
          "sku": merged.isbn || productId,
          "brand": {
            "@type": "Brand",
            "name": merged.publisher || "Librería Belén"
          },
          "offers": {
            "@type": "Offer",
            "priceCurrency": "PEN",
            "price": Number.isFinite(priceValue) ? priceValue.toFixed(2) : "0.00",
            "availability": merged.stock > 0
              ? "https://schema.org/InStock"
              : "https://schema.org/OutOfStock",
            "url": window.location.href
          },
          "additionalProperty": additionalProperty
        };
        jsonLd.textContent = JSON.stringify(productJson);
      }
      });
    </script>
    <script defer src="assets/js/cart.js"></script>
    <script defer src="assets/js/ui.js?v=20260115"></script>
    <script defer src="assets/js/pwa.js"></script>
</body>
</html>











